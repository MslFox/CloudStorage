## Здравствуйте, посмотрите работу пожалуйста, на предмет замечаний, дополнений и ошибок.
Доброго времени суток Андрей!\
Спасибо за обратную связь. Учел ваши советы.\
На сейчас:
- написал тесты, использовал Junit5, Mockito, MockMvc, Container(для БД)
- в папке 'functionalTests' лежат интеграционные тесты для 'file' и 'auth'
- в остальных папках тесты с "замоканными" объектами  
- в процессе написания тестов - немного изменился код в отдельных методах, но в целом логика не изменилась.
- тестовые константы вынес в отдельный класс 'TestConstantHolder'

### Посмотрите пж, что получилось на этом этапе. Если норм и замечаний нет, тогда ->пишу описание и сдаю окончательный вариант работы

### Андрей Денисов ПРЕПОДАВАТЕЛЬ 4 апреля 2023 13:30
>Здравствуйте, Михаил.\
>Спасибо за обновление.\
>Вы справились отлично. Замечаний нет.\
>Могу посоветовать не хранить закомментированный код (где-то видел) и код с пометками типа “может пригодиться в будущем”.\ 
>Поскольку Вы храните код в системе контроля версий, то удаленные части в случае необходимости можно легко вернуть, \
>а по поводу написания кода на будущее - хорошо, что Вы стараетесь предусмотреть, что может пригодиться в будущем, \
>но если не пригодится, то в рамках реального проекта это будет считаться бесполезной тратой ресурсов.\
>Добавляйте тесты, и работа будет полностью выполнена.\
>Успешного завершения работы.
### Михаил Лисин 3 апреля 2023 14:16
>Доброго времени суток Андрей!
>Это приятно и очень продуктивно получать быструю и "дельную" обратную связь! Спасибо!
>1. Переименовал Base64EncoderUtil, методы тоже в соответствии с рекомендацией! ->\
    >Самому не нравилось, не смог сразу найти логику для сокращения имен, и оставил с избытком.\
    >О том, что метод статический и будет вызван с именем класса - как то не подумал. Спасибо! Поможет в будущем, буду\
    >использовать!
>2. Избавился от @Builder в исключениях. Согласен с замечанием, в этой реализации они ни к чему, а в случае\
    >необходимости легко добавить не "трогая" существующую бизнес логику
>3. getHash() -> стал calcHash() -> Так однозначно лучше!
>4. Добавил два файла `success.message.properties`, `error.messages.properties`. "Заимпортил" в `application.properties`.\
    >Компоненты с `@ConfigurationProperties`  в соответствующих классах `SuccessMessage`,`ErrorMessage` и далее по мере
    >необходимости "заинжектированы" в бизнес логику.
>5. Добавил openAPI -> `OpenApiController` и `OpenApiConfig`. Также аннотации в `AuthController` и `FileController`
>- localhost:${server.port}/openapi.yaml выводит openapi.yaml как TEXT.PLAIN, сам файл лежит в корне.
>- localhost:${server.port}/swagger-ui "редиректит" на страничку "http://localhost:${server.port}/swagger-ui/index.html#/" ( более читабельно, наглядно)

### Андрей Денисов ПРЕПОДАВАТЕЛЬ 30 марта 2023 22:01
>Здравствуйте, Михаил.\
>Спасибо за обновление.\
>Вы отлично справились, добавили очень много функционала, переработали код, добавили логирование, liquibase, обработку ошибок.\
>Всё выглядит замечательно.\
>Хорошая идея - вынести константы в отдельный класс, но чтобы избежать излишнего coupling, можно попробовать разделить этот\
>класс на разные классы, сгруппировав в них константы по смыслу. Кроме того, строковые сообщения, такие как сообщения об ошибках,\
>можно вынести в properies-файлы - Spring очень хорошо поддерживает такой механизм. Кстати, хочу отметить, \
>что файл application.properties у Вас отлично структурирован.\
>Добавлять в классы кастомных исключений билдер, наверное, немного избыточно, т.к. у него единственный конструктор с одним аргументом,\
>Вы ничего не выигрываете здесь от применения билдера.\
>Заметно, что Вы очень внимательно подходите к выбору имён для всех сущностей - имена во всём приложении подобраны идеально.\
>Всего пара небольших замечаний:\
>Методы в Base64EncoderUtil названы исчерпывающе информативно и это очень хорошо, но, учитывая, что это статические методы\
>и вызываться они скорей всего будут с упоминанием имени класса, их скорей всего можно назвать короче, например, decode() и encode(),\
>или base64decode() и base64encode(), а сам класс - Base64Util. Base64Util.encode() по-моему тоже вполне читабельно, но гораздо короче.\
>FileUtil.getHash() можно было бы переименовать, например, в calcHash(), так как в данном случае хэш именно вычисляется, а не получается \
>откуда-то.\
>Отличная работа!\
>Желаю Вам так-же успешно справиться с оставшейся частью!

### Михаил Лисин 30 марта 2023 19:26
>Здравствуйте, Андрей!
>
>Благодарю, за замечания и подсказки! Это очень ценно для меня! Спасибо!
>
>1. Использовал пример работы с multipart. Доработал хранилище файлов. Ну и сервис и контроллер тоже пришлось менять.
>2. Доработал исключения, убрал абстрактный класс.(его для себя заводил, по сигнатуре метода сразу видеть,\
>что уже добавил свои правки в обработку)
>3. Добавил ExceptionHandler`ов
>4. Добавил liquibase
>5. Добавил запись лога в файл
>6. Остаются на сделанными Swagger, Тесты, Dockerfiles
>
>Посмотрите пж, что получилось на этом этапе.

### Андрей Денисов ПРЕПОДАВАТЕЛЬ 27 марта 2023 21:48 

>Здравствуйте, Михаил.
>
>Спасибо за выполненную работу.
>
>Хочется отметить качественное выполнение задания - грамотную декомпозицию на пакеты и классы,\
>чистый код, соблюдение style guides. У Вас было мало времени, но Вы сделали большую работу и сделали её хорошо.\
>
>Не очень понятно наличие целой иерархии кастомных исключений с полем message, дублирующим это поле в родительском классе.\
>Если Вы хотите использовать свои собственные иключения, почему не унаследовать их сразу от RuntimeException\
> без промежуточного
>абстрактного класса? Например:>
>
>public class BadRequestException extends RuntimeException {
>public BadRequestException(String message) {
>super(message);
>}
>}
>Посмотреть пример работы с multipart, Вы можете здесь https://spring.io/guides/gs/uploading-files/
>
>И, как Вы сами отметили, хорошо было бы добавить тесты.
>
>Удачи в дальнейшем обучении!

###  Михаил Лисин 27 марта 2023 13:11  
>
>
>Сейчас логика работы программы такова:
>1. Пользователи хранятся в postgres в виде реализации UserDetails
>2. POST login/ получаю логин пароль -> создаю пользователя в базе -> генерирую токен -> возращаю токен.\
>В токен шифрую дату окончания, имя юзера, авторити(по умолчанию "ROLE_USER"). Имя юзера -> шифрую Base64.\
>Для отладки сделал авто регистрацию при отсутствии пользователя в базе (настраивается в application.prooerties)
>3. POST logout/ обрабатывает logoutHandler из filterChain -> в случае если токен еще "живой" , кладет\
>токен в blackList -> чистит контекст -> посылает 200 OK. Также в отдельном потоке пробегает по blackList\
>и чистит его от исживших токенов.
>4. Файлы хранятся в файловой системе в корневой папке проекта
>5. Получаю токен -> валидирую, расшифровываю токен -> кладу в контекст advice
>6. POST, GET, DELETE, PUT работают с файловой системой. Получают имя юзера из контекста, по ним\
>находят папку юзера. -> в случае c новым юзером, создается папка
>7. Имя папок = имя юзера(зашифрованное Base64)
>8. Исключения создаю сам свои DetectedException -> далее обрабатываю свои и  встроенные\
>9. По сути это два сервиса, которые взаимодействуют посредством зашифрованной в JWT информации.
> Моя идея была в том, что (сервис,БД авторизации) и (сервис,хранилище файлов) никаким образом не связаны\
> между собой (за исключением общего секретного ключа токена)
>
>### Вот, как то так. Прошу посмотреть код. Лежал в больнице -> Отстал от сроков.Теперь время очень поджимает. 
>30 марта срок сдачи. Если все норм, то добавляю Swagger, Тесты, Dockerfiles, liquibase(сейчас для отладки\
>стоит "update") 
>### Буду очень благодарен быстрому ответу
>### Вопросы
>1. При отправлке тела в том виде, который указан ниже, файл сохраняется в виде json. Приходится с сервера\
>   отправлять byte[], для "нормалього" сохранения файл, это противоречит указаной схеме. Я чего то не понимаю,\
>   не правильно делаю?
>
>components:
>    File:
>     type: object
>      properties:
>        hash:
>          type: string
>        file:
>          type: string
>          format: binary
> 
>2. Также при POST file/ на серврер приходит мультипарт без значения "hash". Я чего то не понимаю, не правильно делаю?
> 
 
  
